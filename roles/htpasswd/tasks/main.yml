---
# tasks file for htpasswd

#Check if required modules are installed
- name: "Get installed package information"
  community.general.pip_package_info:
    clients: ['pip3']
  register: package_info

- name: "Create htpasswd file"
  ansible.builtin.include_tasks: create_htpasswd_file.yml
  when: create_htpasswd_file == true

- name: "Create htpass secret"
  ansible.builtin.include_tasks: create_htpass_secret.yml
  when: create_htpass_secret == true

- name: "Create oauth config"
  ansible.builtin.include_tasks: create_oauth_config.yml
  when: create_oauth_config == true

- name: "Create group"
  ansible.builtin.include_tasks: create_group.yml
  when: create_group == true

- name: "Create role binding"
  ansible.builtin.include_tasks: create_role_binding.yml
  when: create_role_binding == true

- name: "Display admin password"
  ansible.builtin.debug:
    msg: "Admin password is: {{ htpasswd_password }}"
  when: htpasswd_password is defined

- name: "Clean up config files"
  ansible.builtin.include_tasks: clean_up_config_files.yml

#- name: "Delete kubeadmin"
#  ansible.builtin.include_tasks: remove_kubeadmin.yml
#  when: remove_kubeadmin == true
